# –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Telegram –±–æ—Ç–∞

## –ü—Ä–æ–±–ª–µ–º–∞
–ë–æ—Ç –Ω–µ –æ—Ç–≤–µ—á–∞–µ—Ç –∫–ª–∏–µ–Ω—Ç–∞–º, –ø–æ—Ç–æ–º—É —á—Ç–æ **webhook –Ω–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω**.

## –†–µ—à–µ–Ω–∏–µ

### 1. –ü—Ä–æ–≤–µ—Ä—å `.env` —Ñ–∞–π–ª

–£–±–µ–¥–∏—Å—å —á—Ç–æ –µ—Å—Ç—å —ç—Ç–∏ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ:

```env
TELEGRAM_BOT_TOKEN=123456789:ABCdefGHIjklMNOpqrsTUVwxyz
TELEGRAM_BOT_USERNAME=your_bot_username
TELEGRAM_ADMIN_ID=123456789
NEXTAUTH_URL=https://your-domain.com
```

- `TELEGRAM_BOT_TOKEN` - –ø–æ–ª—É—á–∏ —É @BotFather
- `TELEGRAM_BOT_USERNAME` - username –±–æ—Ç–∞ (–±–µ–∑ @)
- `TELEGRAM_ADMIN_ID` - —Ç–≤–æ–π chat ID (–ø–æ–ª—É—á–∏ —É @userinfobot)
- `NEXTAUTH_URL` - URL –≥–¥–µ –∑–∞–¥–µ–ø–ª–æ–µ–Ω –ø—Ä–æ–µ–∫—Ç

---

### 2. –ó–∞–¥–µ–ø–ª–æ–π –ø—Ä–æ–µ–∫—Ç

–ë–æ—Ç —Ä–∞–±–æ—Ç–∞–µ—Ç —Ç–æ–ª—å–∫–æ –Ω–∞ **–ø—É–±–ª–∏—á–Ω–æ–º –¥–æ–º–µ–Ω–µ** (–Ω–µ localhost).

–í–∞—Ä–∏–∞–Ω—Ç—ã:
- Vercel (–±–µ—Å–ø–ª–∞—Ç–Ω–æ)
- Railway (–±–µ—Å–ø–ª–∞—Ç–Ω–æ)
- Render
- –°–≤–æ–π VPS

–ü–æ—Å–ª–µ –¥–µ–ø–ª–æ—è –∑–∞–ø–æ–º–Ω–∏ URL, –Ω–∞–ø—Ä–∏–º–µ—Ä: `https://your-app.vercel.app`

---

### 3. –£—Å—Ç–∞–Ω–æ–≤–∏ webhook (–û–î–ò–ù –†–ê–ó)

–ü–æ—Å–ª–µ –¥–µ–ø–ª–æ—è –≤—ã–ø–æ–ª–Ω–∏ —ç—Ç—É –∫–æ–º–∞–Ω–¥—É –≤ —Ç–µ—Ä–º–∏–Ω–∞–ª–µ:

```bash
curl -X POST "https://api.telegram.org/bot<YOUR_BOT_TOKEN>/setWebhook?url=https://your-domain.com/api/telegram/webhook"
```

**–ó–∞–º–µ–Ω–∏:**
- `<YOUR_BOT_TOKEN>` - —Ç–æ–∫–µ–Ω –±–æ—Ç–∞ –∏–∑ `.env`
- `https://your-domain.com` - —Ç–≤–æ–π —Ä–µ–∞–ª—å–Ω—ã–π –¥–æ–º–µ–Ω

**–ü—Ä–∏–º–µ—Ä:**
```bash
curl -X POST "https://api.telegram.org/bot123456789:ABCdefGHI/setWebhook?url=https://myapp.vercel.app/api/telegram/webhook"
```

---

### 4. –ü—Ä–æ–≤–µ—Ä—å webhook

```bash
curl "https://api.telegram.org/bot<YOUR_BOT_TOKEN>/getWebhookInfo"
```

**–î–æ–ª–∂–µ–Ω –≤–µ—Ä–Ω—É—Ç—å—Å—è:**
```json
{
  "ok": true,
  "result": {
    "url": "https://your-domain.com/api/telegram/webhook",
    "has_custom_certificate": false,
    "pending_update_count": 0
  }
}
```

---

### 5. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞ localhost (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

–î–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–π —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ –∏—Å–ø–æ–ª—å–∑—É–π **ngrok**:

```bash
# 1. –£—Å—Ç–∞–Ω–æ–≤–∏ ngrok
npm install -g ngrok

# 2. –ó–∞–ø—É—Å—Ç–∏ –ø—Ä–æ–µ–∫—Ç
npm run dev

# 3. –í –¥—Ä—É–≥–æ–º —Ç–µ—Ä–º–∏–Ω–∞–ª–µ –∑–∞–ø—É—Å—Ç–∏ ngrok
ngrok http 3000

# 4. –°–∫–æ–ø–∏—Ä—É–π URL –∏–∑ ngrok (–Ω–∞–ø—Ä–∏–º–µ—Ä: https://abc123.ngrok.io)

# 5. –£—Å—Ç–∞–Ω–æ–≤–∏ –≤—Ä–µ–º–µ–Ω–Ω—ã–π webhook
curl -X POST "https://api.telegram.org/bot<YOUR_BOT_TOKEN>/setWebhook?url=https://abc123.ngrok.io/api/telegram/webhook"
```

‚ö†Ô∏è **–í–∞–∂–Ω–æ:** –ü–æ—Å–ª–µ –∫–∞–∂–¥–æ–≥–æ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞ ngrok URL –º–µ–Ω—è–µ—Ç—Å—è - –Ω—É–∂–Ω–æ –æ–±–Ω–æ–≤–ª—è—Ç—å webhook.

---

## –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç—ã –±–æ—Ç–∞

–ü–æ—Å–ª–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ webhook:

1. –û—Ç–∫—Ä–æ–π –±–æ—Ç–∞ –≤ Telegram
2. –ù–∞–ø–∏—à–∏ `/start`
3. –î–æ–ª–∂–Ω–∞ –ø—Ä–∏–π—Ç–∏ –∫–Ω–æ–ø–∫–∞ "üì± –ü–æ–¥—ñ–ª–∏—Ç–∏—Å—è –Ω–æ–º–µ—Ä–æ–º"
4. –ù–∞–∂–º–∏ –∫–Ω–æ–ø–∫—É ‚Üí –∞–≤—Ç–æ—Ä–∏–∑—É–π—Å—è
5. –ö–æ–º–∞–Ω–¥—ã –∑–∞—Ä–∞–±–æ—Ç–∞—é—Ç: `/my_bookings`, `/contact`

---

## –ß–∞—Å—Ç—ã–µ –æ—à–∏–±–∫–∏

### "Webhook is already set"
–£–¥–∞–ª–∏ —Å—Ç–∞—Ä—ã–π webhook:
```bash
curl -X POST "https://api.telegram.org/bot<YOUR_BOT_TOKEN>/deleteWebhook"
```

### "Bad Request: wrong HTTP URL"
- URL –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å `https://` (–Ω–µ `http://`)
- URL –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –ø—É–±–ª–∏—á–Ω—ã–º (–Ω–µ localhost)

### "Webhook —Ç–∞–π–º-–∞—É—Ç"
- –ü—Ä–æ–≤–µ—Ä—å —á—Ç–æ —ç–Ω–¥–ø–æ–∏–Ω—Ç `/api/telegram/webhook` –æ—Ç–≤–µ—á–∞–µ—Ç –±—ã—Å—Ç—Ä–æ (< 5 —Å–µ–∫)
- –ü—Ä–æ–≤–µ—Ä—å –ª–æ–≥–∏ —Å–µ—Ä–≤–µ—Ä–∞ –Ω–∞ –æ—à–∏–±–∫–∏

---

## –ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç webhook

```
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å ‚Üí –ø–∏—à–µ—Ç /start
      ‚Üì
Telegram —Å–µ—Ä–≤–µ—Ä ‚Üí POST –∑–∞–ø—Ä–æ—Å –Ω–∞ –≤–∞—à webhook
      ‚Üì
/api/telegram/webhook ‚Üí –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –∫–æ–º–∞–Ω–¥—É
      ‚Üì
–û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –æ—Ç–≤–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é
```

**–ë–ï–ó webhook:** Telegram –Ω–µ –∑–Ω–∞–µ—Ç –∫—É–¥–∞ –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å —Å–æ–æ–±—â–µ–Ω–∏—è ‚Üí –±–æ—Ç –º–æ–ª—á–∏—Ç.
**–° webhook:** Telegram –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –≤—Å–µ –Ω–∞ –≤–∞—à —Å–µ—Ä–≤–µ—Ä ‚Üí –±–æ—Ç —Ä–∞–±–æ—Ç–∞–µ—Ç.

---

## –ü–æ—Å–ª–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏

‚úÖ –ê–¥–º–∏–Ω –ø–æ–ª—É—á–∞–µ—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ –Ω–æ–≤—ã—Ö –±—Ä–æ–Ω—è—Ö
‚úÖ –ö–ª–∏–µ–Ω—Ç –º–æ–∂–µ—Ç –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞—Ç—å—Å—è –ø–æ –Ω–æ–º–µ—Ä—É —Ç–µ–ª–µ—Ñ–æ–Ω–∞
‚úÖ –ö–ª–∏–µ–Ω—Ç –º–æ–∂–µ—Ç –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å —á–µ–∫–∏ –æ–ø–ª–∞—Ç—ã
‚úÖ –ö–ª–∏–µ–Ω—Ç –º–æ–∂–µ—Ç —Å–º–æ—Ç—Ä–µ—Ç—å —Å–≤–æ–∏ –±—Ä–æ–Ω–∏ —á–µ—Ä–µ–∑ `/my_bookings`
‚úÖ –ê–¥–º–∏–Ω –º–æ–∂–µ—Ç –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–∞—Ç—å/–æ—Ç–∫–ª–æ–Ω—è—Ç—å –±—Ä–æ–Ω–∏ —á–µ—Ä–µ–∑ inline –∫–Ω–æ–ø–∫–∏

---

## –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

- Telegram Bot API: https://core.telegram.org/bots/api#setwebhook
- Grammy (–±–∏–±–ª–∏–æ—Ç–µ–∫–∞ –±–æ—Ç–∞): https://grammy.dev/
- Ngrok: https://ngrok.com/docs
